"use strict";Object.defineProperty(exports,"__esModule",{value:true});Object.defineProperty(exports,"default",{enumerable:true,get:function(){return _default}});require("core-js/modules/es.promise.js");require("core-js/modules/es.object.to-string.js");require("core-js/modules/es.array.concat.js");require("core-js/modules/es.json.stringify.js");require("core-js/modules/es.array.map.js");var _jsxruntime=require("react/jsx-runtime");var _react=require("react");var _rrwebplayer=require("rrweb-player");require("rrweb-player/dist/style.css");var _indexstyled=require("./index.styled");function _array_like_to_array(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _array_with_holes(arr){if(Array.isArray(arr))return arr}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _async_to_generator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)})}}function _iterable_to_array_limit(arr,i){var _i=arr==null?null:typeof Symbol!=="undefined"&&arr[Symbol.iterator]||arr["@@iterator"];if(_i==null)return;var _arr=[];var _n=true;var _d=false;var _s,_e;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _non_iterable_rest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _sliced_to_array(arr,i){return _array_with_holes(arr)||_iterable_to_array_limit(arr,i)||_unsupported_iterable_to_array(arr,i)||_non_iterable_rest()}function _unsupported_iterable_to_array(o,minLen){if(!o)return;if(typeof o==="string")return _array_like_to_array(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _array_like_to_array(o,minLen)}function _ts_generator(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),"throw":verb(1),"return":verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}}var apiBase="http://localhost:4000";var ReplayComponent=function(){var _useState=_sliced_to_array((0,_react.useState)([]),2),sessions=_useState[0],setSessions=_useState[1];var _useState1=_sliced_to_array((0,_react.useState)(""),2),sessionId=_useState1[0],setSessionId=_useState1[1];var playerRef=(0,_react.useRef)(null);var containerRef=(0,_react.useRef)(null);var unmount=function(){try{var _playerRef_current_getReplayer_destroy,_playerRef_current_getReplayer,_playerRef_current_getReplayer1,_playerRef_current;(_playerRef_current=playerRef.current)===null||_playerRef_current===void 0?void 0:(_playerRef_current_getReplayer1=_playerRef_current.getReplayer)===null||_playerRef_current_getReplayer1===void 0?void 0:(_playerRef_current_getReplayer=_playerRef_current_getReplayer1.call(_playerRef_current))===null||_playerRef_current_getReplayer===void 0?void 0:(_playerRef_current_getReplayer_destroy=_playerRef_current_getReplayer.destroy)===null||_playerRef_current_getReplayer_destroy===void 0?void 0:_playerRef_current_getReplayer_destroy.call(_playerRef_current_getReplayer)}catch(e){}try{var _playerRef_current_$destroy,_playerRef_current1;(_playerRef_current1=playerRef.current)===null||_playerRef_current1===void 0?void 0:(_playerRef_current_$destroy=_playerRef_current1.$destroy)===null||_playerRef_current_$destroy===void 0?void 0:_playerRef_current_$destroy.call(_playerRef_current1)}catch(e){}if(containerRef.current){containerRef.current.innerHTML=""}playerRef.current=null};var handleShowSessions=function(){var _ref=_async_to_generator(function(){var r,data,_data_sessions;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,fetch("".concat(apiBase,"/sessions/list"),{method:"POST"})];case 1:r=_state.sent();return[4,r.json()];case 2:data=_state.sent();setSessions((_data_sessions=data.sessions)!==null&&_data_sessions!==void 0?_data_sessions:[]);return[2]}})});return function handleShowSessions(){return _ref.apply(this,arguments)}}();var handleLoadSession=function(){var _ref=_async_to_generator(function(){var r,data,_data_events,events,target;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(!sessionId){alert("请填写 sessionId");return[2]}return[4,fetch("".concat(apiBase,"/sessions/get"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:sessionId})})];case 1:r=_state.sent();return[4,r.json()];case 2:data=_state.sent();events=(_data_events=data.events)!==null&&_data_events!==void 0?_data_events:[];if(events.length<2){alert("该会话事件不足 2 条，请重新录制（开始录制后做几次点击/输入/滚动，再停止）");return[2]}target=containerRef.current;if(!target)return[2];unmount();playerRef.current=new _rrwebplayer.Player({target:target,props:{events:events,showController:true,width:1e3,height:600,autoPlay:true,speedOption:[.5,1,2,4]}});return[2]}})});return function handleLoadSession(){return _ref.apply(this,arguments)}}();var handleClearSessions=function(){var _ref=_async_to_generator(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:unmount();setSessionId("");return[4,fetch("".concat(apiBase,"/sessions/clear"),{method:"POST"})];case 1:_state.sent();return[4,handleShowSessions()];case 2:_state.sent();return[2]}})});return function handleClearSessions(){return _ref.apply(this,arguments)}}();(0,_react.useEffect)(function(){return function(){unmount()}},[]);return(0,_jsxruntime.jsxs)(_indexstyled.Main,{children:[(0,_jsxruntime.jsx)("h2",{children:"RRWeb 回放 Demo"}),(0,_jsxruntime.jsxs)("div",{className:"row",children:[(0,_jsxruntime.jsx)("div",{children:"会话ID："}),(0,_jsxruntime.jsx)("input",{id:"sessionId",placeholder:"从 /sessions 里挑一个",value:sessionId,onChange:function(e){return setSessionId(e.target.value)}}),(0,_jsxruntime.jsx)("button",{id:"btnLoad",type:"button",onClick:handleLoadSession,children:"加载并播放"}),(0,_jsxruntime.jsx)("button",{id:"btnList",type:"button",onClick:handleShowSessions,children:"列出会话"}),(0,_jsxruntime.jsx)("button",{id:"btnClear",type:"button",onClick:handleClearSessions,children:"清空会话"})]}),(0,_jsxruntime.jsxs)("div",{className:"row",children:[(0,_jsxruntime.jsx)("div",{children:"Sessions:"}),sessions.map(function(s){return(0,_jsxruntime.jsx)("div",{children:s},s)})]}),(0,_jsxruntime.jsx)("div",{ref:containerRef,className:"row"})]})};var _default=ReplayComponent;